Status: active
Owner: platform
Last Reviewed: 2026-02-21
Depends On: PLAN.md, docs/features/README.md
Supersedes: none

# Plan Dependency Matrix

This matrix proves that every planned implementation task depends only on capabilities delivered by earlier tasks/waves.

Rule: no task acceptance criterion may require a capability that is first delivered in a later wave.

## Wave 0

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W0-T1 install-bootstrap | runnable module/runtime skeleton | none | PASS |
| W0-T2 migrations baseline | runnable module/runtime skeleton | W0-T1 | PASS |
| W0-T3 CI gates | runnable module/runtime skeleton | W0-T1 | PASS |

## Wave 1

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W1-T1 node-provision | module + migration baseline | W0-T1, W0-T2 | PASS |
| W1-T2 auth-session | module/runtime skeleton | W0-T1 | PASS |
| W1-T3 queue locking invariants | node-aware mutation execution path | W1-T1 | PASS |
| W1-T4 baseline audit logging | authenticated mutation entrypoints | W1-T2 | PASS |

## Wave 2

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W2-T1 site-create | queue + auth + locks + audit baseline | MP1 (end of Wave 1) | PASS |
| W2-T2 env-create-clone | site create and environment ownership model | W2-T1 | PASS |
| W2-T3 backups | environment ownership and ids | W2-T2 | PASS |
| W2-T4 health-check/rollback | environment lifecycle hooks | W2-T2 | PASS |

## Wave 3

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W3-T1 deploy-updates | mandatory pre-update backup + health/rollback gates | W2-T3, W2-T4 | PASS |
| W3-T2 env-restore | restore backup source + post-restore safety baseline | W3-T1, W2-T3 | PASS |
| W3-T3 promotion-drift | drift/backup gates + deploy safety baseline | W3-T1, W2-T3 | PASS |

## Wave 4

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W4-T1 domains-and-tls | stable lifecycle/restore/promotion baseline | MP2 (end of Wave 3) | PASS |
| W4-T2 cache-controls | stable lifecycle/restore/promotion baseline | MP2 (end of Wave 3) | PASS |
| W4-T3 magic-login | environment records + active-state checks | W2-T2 | PASS |
| W4-T4 site-import | import + rewrite + health-gated platform baseline | MP2 (end of Wave 3) | PASS |
| W4-T5 settings-domain-config | domain/tls runtime behavior contract | W4-T1 | PASS |

## Wave 5

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W5-T1 jobs-and-metrics | jobs generated by lifecycle features | W2-T1 | PASS |
| W5-T3 backup-retention-cleanup | backup record production | W2-T3 | PASS |
| W5-T4 job-control | observable job/resource states for control operations | W5-T1 | PASS |

## Wave 5.5

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W5.5-T1 runtime pivot packet | completed Wave 5 dashboard and queue baseline | W5-T7 | PASS |
| W5.5-T2 self-node target definition | approved runtime pivot packet and acceptance scope | W5.5-T1 | PASS |
| W5.5-T3 runnable runtime provisioning path | self-node execution model + existing queue/ansible wiring | W5.5-T2, W3-T2, W4-T2 | PASS |
| W5.5-T4 reachability-gated success semantics | runnable runtime provisioning + mutation lifecycle | W5.5-T3 | PASS |
| W5.5-T5 end-to-end smoke verification | reachability-gated success semantics | W5.5-T4 | PASS |

## Wave 5.6

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W5.6-T1 hierarchy realignment specs/packet | runtime pivot semantics stabilized enough for scoped planning docs | W5.5-T4 | PASS |
| W5.6-T2 nodes + WP version contract updates | approved hierarchy and inventory feature specs | W5.6-T1 | PASS |
| W5.6-T3 dashboard route hierarchy (`/`, `/nodes`, `/sites`, `/jobs`) | node/site-centric route contract and inventory endpoints | W5.6-T2 | PASS |
| W5.6-T4 site-scoped environments/backups only | route hierarchy in place | W5.6-T3 | PASS |
| W5.6-T5 seed removal + runtime-truth empty states | site-scoped hierarchy complete | W5.6-T4 | PASS |
| W5.6-T6 nodes/sites truth panels | runtime inventory contract + runtime-truth baseline | W5.6-T2, W5.6-T5 | PASS |

## Wave 6

| Task | Capability Required by AC | Provider Task(s) | Forward Dependency Check |
|---|---|---|---|
| W6-T1 deploy-updates | proven runnable runtime baseline + preview reachability validation gate | MP1.5 | PASS |
| W6-T2 health-check/rollback | deploy/update mutation contracts and release transition hooks | W6-T1 | PASS |
| W6-T3 release timeline visibility | health and rollback event surfaces from Wave 6 orchestration | W6-T1, W6-T2 | PASS |

## Known Explicit Non-Dependencies

- Clone expiration metadata is removed from MVP ACs and therefore does not require schema additions in this plan.
- Internal settings surface (`/_admin/settings/*`) is intentionally excluded from public OpenAPI and does not block public API wave execution.
