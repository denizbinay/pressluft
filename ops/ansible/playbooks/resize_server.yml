---
- name: Pressluft resize server
  hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - name: Validate required inputs
      ansible.builtin.assert:
        that:
          - api_token | length > 0
          - server_name | length > 0
          - server_type | length > 0
          - upgrade_disk is not none

    - name: Stop server before resize
      hetzner.hcloud.server:
        api_token: "{{ api_token }}"
        name: "{{ server_name }}"
        state: stopped

    - name: Resize server
      hetzner.hcloud.server:
        api_token: "{{ api_token }}"
        name: "{{ server_name }}"
        server_type: "{{ server_type }}"
        upgrade_disk: "{{ upgrade_disk | bool }}"
        state: present

    - name: Start server after resize
      hetzner.hcloud.server:
        api_token: "{{ api_token }}"
        name: "{{ server_name }}"
        state: started
