---
- name: Pressluft update firewalls
  hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - name: Validate required inputs
      ansible.builtin.assert:
        that:
          - api_token | length > 0
          - server_name | length > 0
          - firewalls_csv | length > 0

    - name: Build firewall list
      ansible.builtin.set_fact:
        firewalls_list: "{{ firewalls_csv.split(',') | map('trim') | reject('equalto', '') | list }}"

    - name: Ensure firewalls list is not empty
      ansible.builtin.assert:
        that:
          - firewalls_list | length > 0

    - name: Update server firewalls
      hetzner.hcloud.server:
        api_token: "{{ api_token }}"
        name: "{{ server_name }}"
        firewalls: "{{ firewalls_list }}"
        state: present
